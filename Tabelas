DROP TABLE AUTORES;
DROP TABLE LIVROS;
DROP TABLE PEDIDOS;
DROP TABLE GENEROS;

CREATE TABLE AUTORES (
    ID_AUTOR        INT             PRIMARY KEY,
    NOME_AUTOR      VARCHAR(100)    NOT NULL
); 

CREATE TABLE LIVROS (
id_livro        INT             PRIMARY KEY,
titulo_livro    VARCHAR(100)    NOT NULL,
id_autor        INT             NULL
);

CREATE TABLE PEDIDOS (
id_pedido       INT     PRIMARY KEY,
id_livro        INT     NULL,
quantidade      INT     NOT NULL,
data_pedido     DATE    NOT NULL
);

CREATE TABLE GENEROS (
    id_genero   INT             PRIMARY KEY,
    nome_genero VARCHAR(50)     NOT NULL
);

ALTER TABLE LIVROS ADD id_genero INT;

ALTER TABLE Livros
ADD FOREIGN KEY (id_genero) REFERENCES Generos(id_genero);

SELECT 
    a.nome_autor,
    g.nome_genero,
    SUM(p.quantidade) AS total_vendas
FROM 
    Pedidos p
JOIN 
    Livros l ON p.id_livro = l.id_livro
JOIN 
    Autores a ON l.id_autor = a.id_autor
JOIN 
    Generos g ON l.id_genero = g.id_genero
GROUP BY 
    a.nome_autor, g.nome_genero
ORDER BY 
    a.nome_autor, g.nome_genero;
